{"version":3,"file":"stimulus_reflex.min.js","sources":["../javascript/app.js","../javascript/schema.js","../javascript/debug.js","../javascript/log.js","../javascript/deprecate.js","../javascript/reflex.js","../javascript/utils.js","../javascript/attributes.js","../javascript/reflex_data.js","../javascript/isolation_mode.js","../javascript/transport.js","../javascript/reflexes.js","../javascript/lifecycle.js","../javascript/process.js","../javascript/transports/action_cable.js","../javascript/callbacks.js","../javascript/controllers.js","../javascript/scanner.js","../javascript/stimulus_reflex.js","../javascript/index.js"],"sourcesContent":["let app = {}\n\nexport default {\n  get app () {\n    return app\n  },\n  set (application) {\n    app = application\n  }\n}\n","const defaultSchema = {\n  reflexAttribute: 'data-reflex',\n  reflexPermanentAttribute: 'data-reflex-permanent',\n  reflexRootAttribute: 'data-reflex-root',\n  reflexSuppressLoggingAttribute: 'data-reflex-suppress-logging',\n  reflexDatasetAttribute: 'data-reflex-dataset',\n  reflexDatasetAllAttribute: 'data-reflex-dataset-all',\n  reflexSerializeFormAttribute: 'data-reflex-serialize-form',\n  reflexFormSelectorAttribute: 'data-reflex-form-selector',\n  reflexIncludeInnerHtmlAttribute: 'data-reflex-include-inner-html',\n  reflexIncludeTextContentAttribute: 'data-reflex-include-text-content'\n}\n\nlet schema = {}\n\nexport { schema, defaultSchema }\n\nexport default {\n  set (application) {\n    schema = { ...defaultSchema, ...application.schema }\n    for (const attribute in schema) {\n      const attributeName = attribute.slice(0, -9)\n\n      if (!this.hasOwnProperty(attributeName)) {\n        Object.defineProperty(this, attributeName, {\n          get: () => {\n            return schema[attribute]\n          }\n        })\n      }\n    }\n  }\n}\n","let debugging = false\n\nexport default {\n  get enabled () {\n    return debugging\n  },\n  get disabled () {\n    return !debugging\n  },\n  get value () {\n    return debugging\n  },\n  set (value) {\n    debugging = !!value\n  },\n  set debug (value) {\n    debugging = !!value\n  }\n}\n","import Debug from './debug'\n\nconst request = reflex => {\n  if (Debug.disabled || reflex.data.suppressLogging) return\n  console.log(`\\u2191 stimulus \\u2191 ${reflex.target}`, {\n    id: reflex.id,\n    args: reflex.data.args,\n    controller: reflex.controller.identifier,\n    element: reflex.element,\n    controllerElement: reflex.controller.element\n  })\n}\n\nconst success = reflex => {\n  if (Debug.disabled || reflex.data.suppressLogging) return\n  const output = {\n    id: reflex.id,\n    morph: reflex.morph,\n    payload: reflex.payload\n  }\n  if (reflex.operation !== 'dispatch_event') output.operation = reflex.operation\n  console.log(\n    `\\u2193 reflex \\u2193 ${reflex.target} \\u2192 ${reflex.selector ||\n      '\\u221E'}${progress(reflex)} ${duration(reflex)}`,\n    output\n  )\n}\n\nconst halted = reflex => {\n  if (Debug.disabled || reflex.data.suppressLogging) return\n  console.log(\n    `\\u2193 reflex \\u2193 ${reflex.target} ${duration(reflex)} %cHALTED`,\n    'color: #ffa500;',\n    { id: reflex.id, payload: reflex.payload }\n  )\n}\n\nconst forbidden = reflex => {\n  if (Debug.disabled || reflex.data.suppressLogging) return\n  console.log(\n    `\\u2193 reflex \\u2193 ${reflex.target} ${duration(reflex)} %cFORBIDDEN`,\n    'color: #BF40BF;',\n    { id: reflex.id, payload: reflex.payload }\n  )\n}\n\nconst error = reflex => {\n  if (Debug.disabled || reflex.data.suppressLogging) return\n  console.log(\n    `\\u2193 reflex \\u2193 ${reflex.target} ${duration(reflex)} %cERROR: ${\n      reflex.error\n    }`,\n    'color: #f00;',\n    { id: reflex.id, payload: reflex.payload }\n  )\n}\n\nconst duration = reflex => {\n  return !reflex.cloned ? `in ${new Date() - reflex.timestamp}ms` : 'CLONED'\n}\n\nconst progress = reflex => {\n  return reflex.totalOperations > 1\n    ? ` ${reflex.completedOperations}/${reflex.totalOperations}`\n    : ''\n}\n\nexport default { request, success, halted, forbidden, error }\n","let deprecationWarnings = true\n\nexport default {\n  get enabled () {\n    return deprecationWarnings\n  },\n  get disabled () {\n    return !deprecationWarnings\n  },\n  get value () {\n    return deprecationWarnings\n  },\n  set (value) {\n    deprecationWarnings = !!value\n  },\n  set deprecate (value) {\n    deprecationWarnings = !!value\n  }\n}\n","import Debug from './debug'\nimport Deprecate from './deprecate'\n\nexport default class Reflex {\n  constructor (data, controller) {\n    this.data = data.valueOf()\n    this.controller = controller\n    this.element = data.reflexElement\n    this.id = data.id\n    this.error = null\n    this.payload = null\n    this.stage = 'created'\n    this.lifecycle = ['created']\n    this.warned = false\n    this.target = data.target\n    this.action = data.target.split('#')[1]\n    this.selector = null\n    this.morph = null\n    this.operation = null\n    this.timestamp = new Date()\n    this.cloned = false // TODO: v4 remove\n  }\n\n  get getPromise () {\n    const promise = new Promise((resolve, reject) => {\n      this.promise = {\n        resolve,\n        reject,\n        data: this.data\n      }\n    })\n    promise.id = this.id\n    // TODO: v4 remove\n    Object.defineProperty(promise, 'reflexId', {\n      get () {\n        if (Deprecate.enabled)\n          console.warn(\n            'reflexId is deprecated and will be removed from v4. Use id instead.'\n          )\n        return this.id\n      }\n    })\n    // END TODO: v4 remove\n    promise.reflex = this\n    if (Debug.enabled) promise.catch(() => {})\n    return promise\n  }\n}\n","import Schema from './schema'\nimport Deprecate from './deprecate'\nimport Debug from './debug'\n\n// uuid4 function taken from stackoverflow\n// https://stackoverflow.com/a/2117523/554903\n\nconst uuidv4 = () => {\n  const crypto = window.crypto || window.msCrypto\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (\n      c ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n    ).toString(16)\n  )\n}\n\nconst serializeForm = (form, options = {}) => {\n  if (!form) return ''\n\n  const w = options.w || window\n  const { element } = options\n  const formData = new w.FormData(form)\n  const data = Array.from(formData, e => e.map(encodeURIComponent).join('='))\n  const submitButton = form.querySelector('input[type=submit]')\n  if (\n    element &&\n    element.name &&\n    element.nodeName === 'INPUT' &&\n    element.type === 'submit'\n  ) {\n    data.push(\n      `${encodeURIComponent(element.name)}=${encodeURIComponent(element.value)}`\n    )\n  } else if (submitButton && submitButton.name) {\n    data.push(\n      `${encodeURIComponent(submitButton.name)}=${encodeURIComponent(\n        submitButton.value\n      )}`\n    )\n  }\n  return Array.from(data).join('&')\n}\n\nconst camelize = (value, uppercaseFirstLetter = true) => {\n  if (typeof value !== 'string') return ''\n  value = value\n    .replace(/[\\s_](.)/g, $1 => $1.toUpperCase())\n    .replace(/[\\s_]/g, '')\n    .replace(/^(.)/, $1 => $1.toLowerCase())\n\n  if (uppercaseFirstLetter)\n    value = value.substr(0, 1).toUpperCase() + value.substr(1)\n\n  return value\n}\n\nconst debounce = (callback, delay = 250) => {\n  let timeoutId\n  return (...args) => {\n    clearTimeout(timeoutId)\n    timeoutId = setTimeout(() => {\n      timeoutId = null\n      callback(...args)\n    }, delay)\n  }\n}\n\nconst extractReflexName = reflexString => {\n  const match = reflexString.match(/(?:.*->)?(.*?)(?:Reflex)?#/)\n\n  return match ? match[1] : ''\n}\n\nconst emitEvent = (event, detail) => {\n  document.dispatchEvent(\n    new CustomEvent(event, {\n      bubbles: true,\n      cancelable: false,\n      detail\n    })\n  )\n  if (window.jQuery) window.jQuery(document).trigger(event, detail)\n}\n\n// construct a valid xPath for an element in the DOM\nconst elementToXPath = element => {\n  if (element.id !== '') return \"//*[@id='\" + element.id + \"']\"\n  if (element === document.body) return '/html/body'\n  if (element.nodeName === 'HTML') return '/html'\n\n  let ix = 0\n  const siblings =\n    element && element.parentNode ? element.parentNode.childNodes : []\n\n  for (var i = 0; i < siblings.length; i++) {\n    const sibling = siblings[i]\n    if (sibling === element) {\n      const computedPath = elementToXPath(element.parentNode)\n      const tagName = element.tagName.toLowerCase()\n      const ixInc = ix + 1\n      return `${computedPath}/${tagName}[${ixInc}]`\n    }\n\n    if (sibling.nodeType === 1 && sibling.tagName === element.tagName) {\n      ix++\n    }\n  }\n}\n\n// TODO: remove this in v4 (potentially!)\nconst XPathToElement = xpath => {\n  return document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.FIRST_ORDERED_NODE_TYPE,\n    null\n  ).singleNodeValue\n}\n\nconst XPathToArray = (xpath, reverse = false) => {\n  const snapshotList = document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  )\n\n  const snapshots = []\n\n  for (let i = 0; i < snapshotList.snapshotLength; i++) {\n    snapshots.push(snapshotList.snapshotItem(i))\n  }\n\n  return reverse ? snapshots.reverse() : snapshots\n}\n\nconst elementInvalid = element => {\n  return (\n    element.type === 'number' && element.validity && element.validity.badInput\n  )\n}\n\nconst getReflexElement = (args, element) => {\n  return args[0] && args[0].nodeType === Node.ELEMENT_NODE\n    ? args.shift()\n    : element\n}\n\nconst getReflexOptions = args => {\n  const options = {}\n  // TODO: remove reflexId in v4\n  if (\n    args[0] &&\n    typeof args[0] === 'object' &&\n    Object.keys(args[0]).filter(key =>\n      [\n        'id',\n        'attrs',\n        'selectors',\n        'reflexId',\n        'resolveLate',\n        'serializeForm',\n        'suppressLogging',\n        'includeInnerHTML',\n        'includeTextContent'\n      ].includes(key)\n    ).length\n  ) {\n    const opts = args.shift()\n    // TODO: in v4, all promises resolve during finalize stage\n    // if they specify resolveLate, console.warn to say that the option will be ignored\n    // deprecation warning in 3.5 is not required as it's still required until v4\n    Object.keys(opts).forEach(o => {\n      // TODO: no need to check for reflexId in v4\n      if (o === 'reflexId') {\n        if (Deprecate.enabled)\n          console.warn('reflexId option will be removed in v4. Use id instead.')\n        options['id'] = opts['reflexId']\n      } else options[o] = opts[o]\n    })\n  }\n  return options\n}\n\n// compute the DOM element(s) which will be the morph root\n// use the data-reflex-root attribute on the reflex or the controller\n// optional value is a CSS selector(s); comma-separated list\n// order of preference is data-reflex, data-controller, document body (default)\nconst getReflexRoots = element => {\n  let list = []\n  while (list.length === 0 && element) {\n    let reflexRoot = element.getAttribute(Schema.reflexRoot)\n    if (reflexRoot) {\n      if (reflexRoot.length === 0 && element.id) reflexRoot = `#${element.id}`\n      const selectors = reflexRoot.split(',').filter(s => s.trim().length)\n      if (Debug.enabled && selectors.length === 0) {\n        console.error(\n          `No value found for ${Schema.reflexRoot}. Add an #id to the element or provide a value for ${Schema.reflexRoot}.`,\n          element\n        )\n      }\n      list = list.concat(selectors.filter(s => document.querySelector(s)))\n    }\n    element = element.parentElement\n      ? element.parentElement.closest(`[${Schema.reflexRoot}]`)\n      : null\n  }\n  return list\n}\n\nexport {\n  uuidv4,\n  serializeForm,\n  camelize,\n  debounce,\n  extractReflexName,\n  emitEvent,\n  elementToXPath,\n  XPathToElement,\n  XPathToArray,\n  elementInvalid,\n  getReflexElement,\n  getReflexOptions,\n  getReflexRoots\n}\n","import Schema from './schema'\nimport Debug from './debug'\nimport Deprecate from './deprecate'\n\nimport { elementToXPath, XPathToArray } from './utils'\n\nconst multipleInstances = element => {\n  if (['checkbox', 'radio'].includes(element.type)) {\n    return (\n      document.querySelectorAll(\n        `input[type=\"${element.type}\"][name=\"${element.name}\"]`\n      ).length > 1\n    )\n  }\n  return false\n}\nconst collectCheckedOptions = element => {\n  return Array.from(element.querySelectorAll('option:checked'))\n    .concat(\n      Array.from(\n        document.querySelectorAll(\n          `input[type=\"${element.type}\"][name=\"${element.name}\"]`\n        )\n      ).filter(elem => elem.checked)\n    )\n    .map(o => o.value)\n}\n\n// Returns a string value for the passed array.\n//\n//   attributeValue(['', 'one', null, 'two', 'three ']) // 'one two three'\n//\nconst attributeValue = (values = []) => {\n  const value = Array.from(\n    new Set(\n      values\n      .filter(v => v && String(v).length)\n      .map(v => v.trim())\n    )\n  ).join(' ').trim()\n\n  return value.length > 0 ? value : null\n}\n\n// Returns an array for the passed string value by splitting on whitespace.\n//\n//   attributeValues('one two three ') // ['one', 'two', 'three']\n//\nconst attributeValues = value => {\n  if (!value) return []\n  if (!value.length) return []\n  return value.split(' ').filter(v => v.trim().length)\n}\n\n// Extracts attributes from a DOM element.\n//\nconst extractElementAttributes = element => {\n  let attrs = Array.from(element.attributes).reduce((memo, attr) => {\n    memo[attr.name] = attr.value\n    return memo\n  }, {})\n\n  attrs.checked = !!element.checked\n  attrs.selected = !!element.selected\n  attrs.tag_name = element.tagName\n\n  if (element.tagName.match(/select/i) || multipleInstances(element)) {\n    const collectedOptions = collectCheckedOptions(element)\n    attrs.values = collectedOptions\n    attrs.value = collectedOptions.join(',')\n  } else {\n    attrs.value = element.value\n  }\n  return attrs\n}\n\n// Returns an array of elements for the provided tokens.\n// Tokens is an array of space separated string coming from the `data-reflex-dataset`\n// or `data-reflex-dataset-all` attribute.\n//\nconst getElementsFromTokens = (element, tokens) => {\n  if (!tokens || tokens.length === 0) return []\n\n  let elements = [element]\n\n  const xPath = elementToXPath(element)\n\n  tokens.forEach(token => {\n    try {\n      switch (token) {\n        case 'combined':\n          if (Deprecate.enabled)\n            console.warn(\n              \"In the next version of StimulusReflex, the 'combined' option to data-reflex-dataset will become 'ancestors'.\"\n            )\n          elements = [\n            ...elements,\n            ...XPathToArray(`${xPath}/ancestor::*`, true)\n          ]\n          break\n        case 'ancestors':\n          elements = [\n            ...elements,\n            ...XPathToArray(`${xPath}/ancestor::*`, true)\n          ]\n          break\n        case 'parent':\n          elements = [...elements, ...XPathToArray(`${xPath}/parent::*`)]\n          break\n        case 'siblings':\n          elements = [\n            ...elements,\n            ...XPathToArray(\n              `${xPath}/preceding-sibling::*|${xPath}/following-sibling::*`\n            )\n          ]\n          break\n        case 'children':\n          elements = [...elements, ...XPathToArray(`${xPath}/child::*`)]\n          break\n        case 'descendants':\n          elements = [...elements, ...XPathToArray(`${xPath}/descendant::*`)]\n          break\n        default:\n          elements = [...elements, ...document.querySelectorAll(token)]\n      }\n    } catch (error) {\n      if (Debug.enabled) console.error(error)\n    }\n  })\n\n  return elements\n}\n\n// Extracts the dataset of an element and combines it with the data attributes from all specified tokens\n//\nconst extractElementDataset = element => {\n  const dataset = element.attributes[Schema.reflexDataset]\n  const allDataset = element.attributes[Schema.reflexDatasetAll]\n\n  const tokens = (dataset && dataset.value.split(' ')) || []\n  const allTokens = (allDataset && allDataset.value.split(' ')) || []\n\n  const datasetElements = getElementsFromTokens(element, tokens)\n  const datasetAllElements = getElementsFromTokens(element, allTokens)\n\n  const datasetAttributes = datasetElements.reduce((acc, ele) => {\n    return { ...extractDataAttributes(ele), ...acc }\n  }, {})\n\n  const reflexElementAttributes = extractDataAttributes(element)\n\n  const elementDataset = {\n    dataset: { ...reflexElementAttributes, ...datasetAttributes },\n    datasetAll: {}\n  }\n\n  datasetAllElements.forEach(element => {\n    const elementAttributes = extractDataAttributes(element)\n\n    Object.keys(elementAttributes).forEach(key => {\n      const value = elementAttributes[key]\n\n      if (\n        elementDataset.datasetAll[key] &&\n        Array.isArray(elementDataset.datasetAll[key])\n      ) {\n        elementDataset.datasetAll[key].push(value)\n      } else {\n        elementDataset.datasetAll[key] = [value]\n      }\n    })\n  })\n\n  return elementDataset\n}\n\n// Extracts all data attributes from a DOM element.\n//\nconst extractDataAttributes = element => {\n  let attrs = {}\n\n  if (element && element.attributes) {\n    Array.from(element.attributes).forEach(attr => {\n      if (attr.name.startsWith('data-')) {\n        attrs[attr.name] = attr.value\n      }\n    })\n  }\n\n  return attrs\n}\n\nexport {\n  attributeValue,\n  attributeValues,\n  extractElementAttributes,\n  extractElementDataset,\n  extractDataAttributes\n}\n","import Schema from './schema'\n\nimport { extractElementAttributes, extractElementDataset } from './attributes'\nimport { uuidv4, getReflexRoots, elementToXPath } from './utils'\nimport packageInfo from '../package.json'\n\nexport default class ReflexData {\n  constructor (\n    options,\n    reflexElement,\n    controllerElement,\n    reflexController,\n    permanentAttributeName,\n    target,\n    args,\n    url,\n    tabId\n  ) {\n    this.options = options\n    this.reflexElement = reflexElement\n    this.controllerElement = controllerElement\n    this.reflexController = reflexController\n    this.permanentAttributeName = permanentAttributeName\n    this.target = target\n    this.args = args\n    this.url = url\n    this.tabId = tabId\n  }\n\n  get attrs () {\n    this._attrs =\n      this._attrs ||\n      this.options['attrs'] ||\n      extractElementAttributes(this.reflexElement)\n\n    return this._attrs\n  }\n\n  get id () {\n    this._id = this._id || this.options['id'] || uuidv4()\n    return this._id\n  }\n\n  get selectors () {\n    this._selectors =\n      this._selectors ||\n      this.options['selectors'] ||\n      getReflexRoots(this.reflexElement)\n\n    return typeof this._selectors === 'string'\n      ? [this._selectors]\n      : this._selectors\n  }\n\n  // TODO: v4 always resolve late\n  get resolveLate () {\n    return this.options['resolveLate'] || false\n  }\n\n  get dataset () {\n    this._dataset = this._dataset || extractElementDataset(this.reflexElement)\n    return this._dataset\n  }\n\n  get innerHTML () {\n    return this.includeInnerHtml ? this.reflexElement.innerHTML : ''\n  }\n\n  get textContent () {\n    return this.includeTextContent ? this.reflexElement.textContent : ''\n  }\n\n  // TODO: remove this in v4\n  get xpathController () {\n    return elementToXPath(this.controllerElement)\n  }\n\n  get xpathElement () {\n    return elementToXPath(this.reflexElement)\n  }\n  // END TODO remove\n\n  get formSelector () {\n    const attr = this.reflexElement.attributes[Schema.reflexFormSelector]\n      ? this.reflexElement.attributes[Schema.reflexFormSelector].value\n      : undefined\n    return this.options['formSelector'] || attr\n  }\n\n  get includeInnerHtml () {\n    const attr =\n      this.reflexElement.attributes[Schema.reflexIncludeInnerHtml] || false\n    return this.options['includeInnerHTML'] || attr\n      ? attr.value !== 'false'\n      : false\n  }\n\n  get includeTextContent () {\n    const attr =\n      this.reflexElement.attributes[Schema.reflexIncludeTextContent] || false\n    return this.options['includeTextContent'] || attr\n      ? attr.value !== 'false'\n      : false\n  }\n\n  get suppressLogging () {\n    return (\n      this.options['suppressLogging'] ||\n      this.reflexElement.attributes[Schema.reflexSuppressLogging] ||\n      false\n    )\n  }\n\n  valueOf () {\n    return {\n      attrs: this.attrs,\n      dataset: this.dataset,\n      selectors: this.selectors,\n      id: this.id,\n      resolveLate: this.resolveLate,\n      suppressLogging: this.suppressLogging,\n      xpathController: this.xpathController,\n      xpathElement: this.xpathElement,\n      inner_html: this.innerHTML,\n      text_content: this.textContent,\n      formSelector: this.formSelector,\n      reflexController: this.reflexController,\n      permanentAttributeName: this.permanentAttributeName,\n      target: this.target,\n      args: this.args,\n      url: this.url,\n      tabId: this.tabId,\n      version: packageInfo.version\n    }\n  }\n}\n","import Deprecate from './deprecate'\n\nlet isolationMode = false\n\nexport default {\n  get disabled () {\n    return !isolationMode\n  },\n  set (value) {\n    isolationMode = value\n    if (Deprecate.enabled && !isolationMode) {\n      document.addEventListener(\n        'DOMContentLoaded',\n        () =>\n          console.warn(\n            'Deprecation warning: the next version of StimulusReflex will standardize isolation mode, and the isolate option will be removed.\\nPlease update your applications to assume that every tab will be isolated. Use CableReady operations to broadcast updates to other tabs and users.'\n          ),\n        { once: true }\n      )\n    }\n  }\n}\n","let transport = {}\n\nexport default {\n  get plugin () {\n    return transport\n  },\n  set (newTransport) {\n    transport = newTransport\n  }\n}\n","const stages = [\n  'created',\n  'before',\n  'delivered',\n  'queued',\n  'after',\n  'finalized',\n  'success',\n  'error',\n  'halted',\n  'forbidden'\n]\nlet lastReflex\n\nexport const reflexes = new Proxy(\n  {}, // You are standing in an open field west of a white house, with a boarded front door.\n  {\n    get: function (target, prop) {\n      if (stages.includes(prop))\n        return Object.fromEntries(\n          Object.entries(target).filter(([_, reflex]) => reflex.stage === prop)\n        )\n      else if (prop === 'last') return lastReflex\n      else if (prop === 'all') return target\n      return Reflect.get(...arguments)\n    },\n    set: function (target, prop, value) {\n      target[prop] = value\n      lastReflex = value\n      return true\n    }\n  }\n)\n","import Debug from './debug'\n\nimport { reflexes } from './reflexes'\nimport { camelize } from './utils'\n\n// lifecycle stages\n//   * created (at initialization)\n//   * before\n//   * delivered\n//   * queued\n//   * success\n//   * error\n//   * halted\n//   * forbidden\n//   * after\n//   * finalize\n\n// Invokes a lifecycle method on a StimulusReflex controller.\n// - reflex - the Reflex object\n// - stage - the lifecycle stage\n//\nconst invokeLifecycleMethod = (reflex, stage) => {\n  // TODO: v4 reevaluate benefit of naming complexity vs semantic payoff\n  const specificLifecycleMethod =\n    reflex.controller[\n      ['before', 'after', 'finalize'].includes(stage)\n        ? `${stage}${camelize(reflex.action)}`\n        : `${camelize(reflex.action, false)}${camelize(stage)}`\n    ]\n\n  const genericLifecycleMethod =\n    reflex.controller[\n      ['before', 'after', 'finalize'].includes(stage)\n        ? `${stage}Reflex`\n        : `reflex${camelize(stage)}`\n    ]\n\n  // TODO: v4 just pass reflex into the lifecycle method\n  if (typeof specificLifecycleMethod === 'function') {\n    specificLifecycleMethod.call(\n      reflex.controller,\n      reflex.element,\n      reflex.target,\n      reflex.error,\n      reflex.id,\n      reflex.payload\n    )\n  }\n\n  // TODO: v4 just pass reflex into the lifecycle method\n  if (typeof genericLifecycleMethod === 'function') {\n    genericLifecycleMethod.call(\n      reflex.controller,\n      reflex.element,\n      reflex.target,\n      reflex.error,\n      reflex.id,\n      reflex.payload\n    )\n  }\n}\n\n// Dispatches a lifecycle event on document\n// - reflex - the Reflex object\n// - stage - the lifecycle stage\n//\nconst dispatchLifecycleEvent = (reflex, stage) => {\n  if (!reflex.controller.element.parentElement) {\n    if (Debug.enabled && !reflex.warned) {\n      console.warn(\n        `StimulusReflex was not able execute callbacks or emit events for \"${stage}\" or later life-cycle stages for this Reflex. The StimulusReflex Controller Element is no longer present in the DOM. Could you move the StimulusReflex Controller to an element higher in your DOM?`\n      )\n      reflex.warned = true\n    }\n    return\n  }\n\n  reflex.stage = stage\n  reflex.lifecycle.push(stage)\n\n  const event = `stimulus-reflex:${stage}`\n  const action = `${event}:${reflex.action}`\n  // TODO: v4 detail = reflex\n  const detail = {\n    reflex: reflex.target,\n    controller: reflex.controller,\n    id: reflex.id,\n    element: reflex.element,\n    payload: reflex.payload\n  }\n  const options = { bubbles: true, cancelable: false, detail }\n\n  reflex.controller.element.dispatchEvent(new CustomEvent(event, options))\n  reflex.controller.element.dispatchEvent(new CustomEvent(action, options))\n\n  if (window.jQuery) {\n    window.jQuery(reflex.controller.element).trigger(event, detail)\n    window.jQuery(reflex.controller.element).trigger(action, detail)\n  }\n}\n\ndocument.addEventListener(\n  'stimulus-reflex:before',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'before'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:queued',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'queued'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:delivered',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'delivered'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:success',\n  event => {\n    const reflex = reflexes[event.detail.id]\n    invokeLifecycleMethod(reflex, 'success')\n    dispatchLifecycleEvent(reflex, 'after')\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:nothing',\n  event => dispatchLifecycleEvent(reflexes[event.detail.id], 'success'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:error',\n  event => {\n    const reflex = reflexes[event.detail.id]\n    invokeLifecycleMethod(reflex, 'error')\n    // TODO: v4 remove after events on error; behave like halted and forbidden\n    dispatchLifecycleEvent(reflex, 'after')\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:halted',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'halted'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:forbidden',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'forbidden'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:after',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'after'),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:finalize',\n  event => invokeLifecycleMethod(reflexes[event.detail.id], 'finalize'),\n  true\n)\n\nexport { dispatchLifecycleEvent }\n","import CableReady from 'cable_ready'\n\nimport Debug from './debug'\nimport Stimulus from './app'\nimport Reflex from './reflex'\nimport IsolationMode from './isolation_mode'\n\nimport { reflexes } from './reflexes'\nimport { dispatchLifecycleEvent } from './lifecycle'\nimport { XPathToElement } from './utils'\n\nexport const received = data => {\n  if (!data.cableReady) return\n\n  if (data.version.replace('.pre', '-pre') !== CableReady.version) {\n    if (Debug.enabled)\n      console.error(\n        `Reflex failed due to cable_ready gem/NPM package version mismatch. Package versions must match exactly.\\nNote that if you are using pre-release builds, gems use the \"x.y.z.preN\" version format, while NPM packages use \"x.y.z-preN\".\\n\\ncable_ready gem: ${data.version}\\ncable_ready NPM: ${CableReady.version}`\n      )\n    return\n  }\n\n  let reflexOperations = []\n\n  for (let i = data.operations.length - 1; i >= 0; i--) {\n    if (data.operations[i].stimulusReflex) {\n      reflexOperations.push(data.operations[i])\n      data.operations.splice(i, 1)\n    }\n  }\n\n  if (\n    reflexOperations.some(\n      operation => operation.stimulusReflex.url !== location.href\n    )\n  ) {\n    if (Debug.enabled) {\n      console.error('Reflex failed due to mismatched URL.')\n      return\n    }\n  }\n\n  let reflexData\n\n  if (reflexOperations.length) {\n    reflexData = reflexOperations[0].stimulusReflex\n    reflexData.payload = reflexOperations[0].payload\n  }\n\n  if (reflexData) {\n    const { id, payload } = reflexData\n    let reflex\n\n    // TODO: remove this in v4\n    if (!reflexes[id] && IsolationMode.disabled) {\n      const controllerElement = XPathToElement(reflexData.xpathController)\n      const reflexElement = XPathToElement(reflexData.xpathElement)\n\n      controllerElement.reflexController =\n        controllerElement.reflexController || {}\n      controllerElement.reflexData = controllerElement.reflexData || {}\n      controllerElement.reflexError = controllerElement.reflexError || {}\n\n      const controller = Stimulus.app.getControllerForElementAndIdentifier(\n        controllerElement,\n        reflexData.reflexController\n      )\n\n      controllerElement.reflexController[id] = controller\n      controllerElement.reflexData[id] = reflexData\n\n      reflex = new Reflex(reflexData, controller)\n      reflexes[id] = reflex\n      reflex.cloned = true\n      reflex.element = reflexElement\n      controller.lastReflex = reflex\n\n      dispatchLifecycleEvent(reflex, 'before')\n      reflex.getPromise\n    } else {\n      // v4 keep this, make it a const\n      reflex = reflexes[id]\n    }\n    // END TODO: remove\n\n    if (reflex) {\n      reflex.payload = payload\n      reflex.totalOperations = reflexOperations.length\n      reflex.pendingOperations = reflexOperations.length\n      reflex.completedOperations = 0\n      reflex.piggybackOperations = data.operations\n      CableReady.perform(reflexOperations)\n    }\n  } else {\n    if (data.operations.length && reflexes[data.operations[0].reflexId]) {\n      CableReady.perform(data.operations)\n    }\n  }\n}\n","import { createConsumer } from '@rails/actioncable'\nimport { emitEvent } from '../utils'\nimport { dispatchLifecycleEvent } from '../lifecycle'\nimport { reflexes } from '../reflexes'\nimport { received } from '../process'\n\nimport Deprecate from '../deprecate'\n\nlet consumer\nlet params\nlet subscription\nlet active\n\nconst initialize = (consumerValue, paramsValue) => {\n  consumer = consumerValue\n  params = paramsValue\n  document.addEventListener('DOMContentLoaded', () => {\n    active = false\n    connectionStatusClass()\n    if (Deprecate.enabled && consumerValue)\n      console.warn(\n        \"Deprecation warning: the next version of StimulusReflex will obtain a reference to consumer via the Stimulus application object.\\nPlease add 'application.consumer = consumer' to your index.js after your Stimulus application has been established, and remove the consumer key from your StimulusReflex initialize() options object.\"\n      )\n  })\n  document.addEventListener('turbolinks:load', connectionStatusClass)\n  document.addEventListener('turbo:load', connectionStatusClass)\n}\n\nconst subscribe = controller => {\n  if (subscription) return\n  consumer = consumer || controller.application.consumer || createConsumer()\n  const { channel } = controller.StimulusReflex\n  const request = { channel, ...params }\n  const identifier = JSON.stringify(request)\n\n  subscription =\n    consumer.subscriptions.findAll(identifier)[0] ||\n    consumer.subscriptions.create(request, {\n      received,\n      connected,\n      rejected,\n      disconnected\n    })\n}\n\nconst connected = () => {\n  active = true\n  connectionStatusClass()\n  emitEvent('stimulus-reflex:connected')\n  Object.values(reflexes.queued).forEach(reflex => {\n    subscription.send(reflex.data)\n    dispatchLifecycleEvent(reflex, 'delivered')\n  })\n}\n\nconst rejected = () => {\n  active = false\n  connectionStatusClass()\n  emitEvent('stimulus-reflex:rejected')\n  if (Debug.enabled) console.warn('Channel subscription was rejected.')\n}\n\nconst disconnected = willAttemptReconnect => {\n  active = false\n  connectionStatusClass()\n  emitEvent('stimulus-reflex:disconnected', willAttemptReconnect)\n}\n\nconst deliver = reflex => {\n  if (active) {\n    subscription.send(reflex.data)\n    dispatchLifecycleEvent(reflex, 'delivered')\n  } else dispatchLifecycleEvent(reflex, 'queued')\n}\n\nconst connectionStatusClass = () => {\n  const list = document.body.classList\n  if (\n    !(\n      list.contains('stimulus-reflex-connected') ||\n      list.contains('stimulus-reflex-disconnected')\n    )\n  ) {\n    list.add(\n      active ? 'stimulus-reflex-connected' : 'stimulus-reflex-disconnected'\n    )\n    return\n  }\n  if (active) {\n    list.replace('stimulus-reflex-disconnected', 'stimulus-reflex-connected')\n  } else {\n    list.replace('stimulus-reflex-connected', 'stimulus-reflex-disconnected')\n  }\n}\n\nexport default {\n  subscribe,\n  deliver,\n  initialize\n}\n","import CableReady from 'cable_ready'\nimport Log from './log'\n\nimport { reflexes } from './reflexes'\nimport { dispatchLifecycleEvent } from './lifecycle'\n\nconst beforeDOMUpdate = event => {\n  const { stimulusReflex } = event.detail || {}\n  if (!stimulusReflex) return\n  const reflex = reflexes[stimulusReflex.id]\n\n  reflex.pendingOperations--\n\n  if (reflex.pendingOperations > 0) return\n\n  // TODO: remove in v4 - always resolve late\n  if (!stimulusReflex.resolveLate)\n    setTimeout(() =>\n      reflex.promise.resolve({\n        element: reflex.element,\n        event,\n        data: reflex.data,\n        payload: reflex.payload,\n        id: reflex.id,\n        toString: () => ''\n      })\n    )\n  // END TODO: remove\n\n  setTimeout(() => dispatchLifecycleEvent(reflex, 'success'))\n}\n\nconst afterDOMUpdate = event => {\n  const { stimulusReflex } = event.detail || {}\n  if (!stimulusReflex) return\n  const reflex = reflexes[stimulusReflex.id]\n\n  reflex.completedOperations++\n  reflex.selector = event.detail.selector\n  reflex.morph = event.detail.stimulusReflex.morph\n  reflex.operation = event.type\n    .split(':')[1]\n    .split('-')\n    .slice(1)\n    .join('_')\n\n  Log.success(reflex)\n\n  if (reflex.completedOperations < reflex.totalOperations) return\n\n  // TODO: v4 always resolve late (remove if)\n  // TODO: v4 simplify to {reflex, toString}\n  if (stimulusReflex.resolveLate)\n    setTimeout(() =>\n      reflex.promise.resolve({\n        element: reflex.element,\n        event,\n        data: reflex.data,\n        payload: reflex.payload,\n        id: reflex.id,\n        toString: () => ''\n      })\n    )\n\n  setTimeout(() => dispatchLifecycleEvent(reflex, 'finalize'))\n\n  if (reflex.piggybackOperations.length)\n    CableReady.perform(reflex.piggybackOperations)\n}\n\nconst routeReflexEvent = event => {\n  const { stimulusReflex, name } = event.detail || {}\n  const eventType = name.split('-')[2]\n\n  const eventTypes = { nothing, halted, forbidden, error }\n\n  if (!stimulusReflex || !Object.keys(eventTypes).includes(eventType)) return\n\n  const reflex = reflexes[stimulusReflex.id]\n  reflex.completedOperations++\n  reflex.pendingOperations--\n  reflex.selector = event.detail.selector\n  reflex.morph = event.detail.stimulusReflex.morph\n  reflex.operation = event.type\n    .split(':')[1]\n    .split('-')\n    .slice(1)\n    .join('_')\n  if (eventType === 'error') reflex.error = event.detail.error\n\n  eventTypes[eventType](reflex, event)\n\n  setTimeout(() => dispatchLifecycleEvent(reflex, eventType))\n\n  if (reflex.piggybackOperations.length)\n    CableReady.perform(reflex.piggybackOperations)\n}\n\nconst nothing = (reflex, event) => {\n  Log.success(reflex)\n\n  // TODO: v4 simplify to {reflex, toString}\n  setTimeout(() =>\n    reflex.promise.resolve({\n      data: reflex.data,\n      element: reflex.element,\n      event,\n      payload: reflex.payload,\n      id: reflex.id,\n      toString: () => ''\n    })\n  )\n}\n\nconst halted = (reflex, event) => {\n  Log.halted(reflex, event)\n\n  // TODO: v4 simplify to {reflex, toString}\n  setTimeout(() =>\n    reflex.promise.resolve({\n      data: reflex.data,\n      element: reflex.element,\n      event,\n      payload: reflex.payload,\n      id: reflex.id,\n      toString: () => ''\n    })\n  )\n}\n\nconst forbidden = (reflex, event) => {\n  Log.forbidden(reflex, event)\n\n  // TODO: v4 simplify to {reflex, toString}\n  setTimeout(() =>\n    reflex.promise.resolve({\n      data: reflex.data,\n      element: reflex.element,\n      event,\n      payload: reflex.payload,\n      id: reflex.id,\n      toString: () => ''\n    })\n  )\n}\n\nconst error = (reflex, event) => {\n  Log.error(reflex, event)\n\n  // TODO: v4 simplify to {reflex, toString}\n  // TODO: v4 convert to resolve?\n  setTimeout(() =>\n    reflex.promise.reject({\n      data: reflex.data,\n      element: reflex.element,\n      event,\n      payload: reflex.payload,\n      id: reflex.id,\n      error: reflex.error,\n      toString: () => reflex.error\n    })\n  )\n}\n\nexport { beforeDOMUpdate, afterDOMUpdate, routeReflexEvent }\n","import Schema from './schema'\nimport Stimulus from './app'\n\nimport { attributeValues } from './attributes'\nimport { extractReflexName } from './utils'\n\n// Returns StimulusReflex controllers local to the passed element based on the data-controller attribute.\n//\nconst localReflexControllers = element => {\n  return attributeValues(element.getAttribute(Schema.controller)).reduce(\n    (memo, name) => {\n      const controller = Stimulus.app.getControllerForElementAndIdentifier(\n        element,\n        name\n      )\n      if (controller && controller.StimulusReflex) memo.push(controller)\n      return memo\n    },\n    []\n  )\n}\n\n// Returns all StimulusReflex controllers for the passed element.\n// Traverses DOM ancestors starting with element.\n//\nconst allReflexControllers = element => {\n  let controllers = []\n  while (element) {\n    controllers = controllers.concat(localReflexControllers(element))\n    element = element.parentElement\n  }\n  return controllers\n}\n\n// Given a reflex string such as 'click->TestReflex#create' and a list of\n// controllers. It will find the matching controller based on the controller's\n// identifier. e.g. Given these controller identifiers ['foo', 'bar', 'test'],\n// it would select the 'test' controller.\nconst findControllerByReflexName = (reflexName, controllers) => {\n  const controller = controllers.find(controller => {\n    if (!controller.identifier) return\n\n    return (\n      extractReflexName(reflexName)\n        .replace(/([a-z0â€“9])([A-Z])/g, '$1-$2')\n        .replace(/(::)/g, '--')\n        .toLowerCase() === controller.identifier\n    )\n  })\n\n  return controller || controllers[0]\n}\n\nexport { allReflexControllers, findControllerByReflexName }\n","import { reflexes } from './reflexes'\nimport Schema from './schema'\nimport { attributeValues, attributeValue } from './attributes'\nimport { findControllerByReflexName, allReflexControllers } from './controllers'\nimport { debounce, emitEvent } from './utils'\n\n// Sets up declarative reflex behavior.\n// Any elements that define data-reflex will automatically be wired up with the default StimulusReflexController.\n//\nconst scanForReflexes = debounce(() => {\n  const reflexElements = document.querySelectorAll(`[${Schema.reflex}]`)\n  reflexElements.forEach(element => scanForReflexesOnElement(element))\n  emitEvent('stimulus-reflex:ready')\n}, 20)\n\nconst scanForReflexesOnElement = element => {\n  const controllerAttribute = element.getAttribute(Schema.controller)\n  const controllers = attributeValues(controllerAttribute)\n\n  const reflexAttribute = element.getAttribute(Schema.reflex)\n  const reflexAttributeNames = attributeValues(reflexAttribute)\n\n  const actionAttribute = element.getAttribute(Schema.action)\n  const actions = attributeValues(actionAttribute).filter(\n    action => !action.includes('#__perform')\n  )\n\n  reflexAttributeNames.forEach(reflexName => {\n    const controller = findControllerByReflexName(\n      reflexName,\n      allReflexControllers(element)\n    )\n    const controllerName = controller\n      ? controller.identifier\n      : 'stimulus-reflex'\n\n    actions.push(`${reflexName.split('->')[0]}->${controllerName}#__perform`)\n    controllers.push(controllerName)\n  })\n\n  const controllerValue = attributeValue(controllers)\n  const actionValue = attributeValue(actions)\n\n  if (\n    controllerValue &&\n    element.getAttribute(Schema.controller) != controllerValue\n  ) {\n    element.setAttribute(Schema.controller, controllerValue)\n  }\n\n  if (actionValue && element.getAttribute(Schema.action) != actionValue) {\n    element.setAttribute(Schema.action, actionValue)\n  }\n}\nexport { scanForReflexes, scanForReflexesOnElement }\n","import { Controller } from '@hotwired/stimulus'\n\nimport Stimulus from './app'\nimport Schema from './schema'\nimport Log from './log'\nimport Debug from './debug'\nimport Deprecate from './deprecate'\nimport Reflex from './reflex'\nimport ReflexData from './reflex_data'\nimport IsolationMode from './isolation_mode'\nimport Transport from './transport'\nimport ActionCableTransport from './transports/action_cable'\n\nimport { reflexes } from './reflexes'\nimport { dispatchLifecycleEvent } from './lifecycle'\nimport { beforeDOMUpdate, afterDOMUpdate, routeReflexEvent } from './callbacks'\nimport { attributeValues } from './attributes'\nimport { scanForReflexes, scanForReflexesOnElement } from './scanner'\nimport {\n  uuidv4,\n  serializeForm,\n  elementInvalid,\n  getReflexElement,\n  getReflexOptions,\n  emitEvent\n} from './utils'\n\n// Default StimulusReflexController that is implicitly wired up as data-controller for any DOM elements\n// that have configured data-reflex. Note that this default can be overridden when initializing the application.\n// i.e. StimulusReflex.initialize(myStimulusApplication, MyCustomDefaultController)\n//\nclass StimulusReflexController extends Controller {\n  constructor (...args) {\n    super(...args)\n    register(this)\n  }\n}\n\n// Uniquely identify this browser tab in each Reflex\nconst tabId = uuidv4()\n\n// Initializes StimulusReflex by registering the default Stimulus controller with the passed Stimulus application.\n//\n// - application  - the Stimulus application\n// - options\n//   * controller - [optional] the default StimulusReflexController\n//   * consumer   - [optional] the ActionCable consumer\n//   * debug      - [false] log all Reflexes to the console\n//   * params     - [{}] key/value parameters to send during channel subscription\n//   * isolate    - [false] restrict Reflex playback to the tab which initiated it\n//   * deprecate  - [true] show warnings regarding upcoming changes to the library\n//\nconst initialize = (\n  application,\n  { controller, consumer, debug, params, isolate, deprecate, transport } = {}\n) => {\n  Transport.set(transport || ActionCableTransport)\n  Transport.plugin.initialize(consumer, params)\n  IsolationMode.set(!!isolate)\n  Stimulus.set(application)\n  Schema.set(application)\n  Stimulus.app.register(\n    'stimulus-reflex',\n    controller || StimulusReflexController\n  )\n  Debug.set(!!debug)\n  if (typeof deprecate !== 'undefined') Deprecate.set(deprecate)\n  const observer = new MutationObserver(scanForReflexes)\n  observer.observe(document.documentElement, {\n    attributeFilter: [Schema.reflex, Schema.action],\n    childList: true,\n    subtree: true\n  })\n  emitEvent('stimulus-reflex:initialized')\n}\n\n// Registers a Stimulus controller and extends it with StimulusReflex behavior\n//\n// controller - the Stimulus controller\n// options - [optional] configuration\n//\nconst register = (controller, options = {}) => {\n  const channel = 'StimulusReflex::Channel'\n  controller.StimulusReflex = { ...options, channel }\n  Transport.plugin.subscribe(controller)\n  Object.assign(controller, {\n    // Invokes a server side reflex method.\n    //\n    // - target - the reflex target (full name of the server side reflex) i.e. 'ReflexClassName#method'\n    // - reflexElement - [optional] the element that triggered the reflex, defaults to this.element\n    // - options - [optional] an object that contains at least one of attrs, id, selectors, resolveLate, serializeForm\n    // - *args - remaining arguments are forwarded to the server side reflex method\n    //\n    stimulate () {\n      const url = location.href\n      const controllerElement = this.element\n      const args = Array.from(arguments)\n      const target = args.shift() || 'StimulusReflex::Reflex#default_reflex'\n      const reflexElement = getReflexElement(args, controllerElement)\n\n      if (elementInvalid(reflexElement)) {\n        if (Debug.enabled) console.warn('Reflex aborted: invalid numeric input')\n        return\n      }\n\n      const options = getReflexOptions(args)\n\n      const reflexData = new ReflexData(\n        options,\n        reflexElement,\n        controllerElement,\n        this.identifier,\n        Schema.reflexPermanent,\n        target,\n        args,\n        url,\n        tabId\n      )\n\n      const id = reflexData.id\n\n      // TODO: remove this in v4\n      controllerElement.reflexController =\n        controllerElement.reflexController || {}\n      controllerElement.reflexData = controllerElement.reflexData || {}\n      controllerElement.reflexError = controllerElement.reflexError || {}\n\n      controllerElement.reflexController[id] = this\n      controllerElement.reflexData[id] = reflexData.valueOf()\n      // END TODO: remove\n\n      const reflex = new Reflex(reflexData, this)\n      reflexes[id] = reflex\n      this.lastReflex = reflex\n\n      dispatchLifecycleEvent(reflex, 'before')\n\n      setTimeout(() => {\n        // TODO: in v4, params will be set on the reflex.data object\n        const { params } = controllerElement.reflexData[id] || {}\n\n        const check = reflexElement.attributes[Schema.reflexSerializeForm]\n        if (check) {\n          options['serializeForm'] = check.value !== 'false'\n        }\n\n        const form =\n          reflexElement.closest(reflexData.formSelector) ||\n          document.querySelector(reflexData.formSelector) ||\n          reflexElement.closest('form')\n\n        // TODO: remove this in v4\n        if (Deprecate.enabled && options['serializeForm'] === undefined && form)\n          console.warn(\n            `Deprecation warning: the next version of StimulusReflex will not serialize forms by default.\\nPlease set ${Schema.reflexSerializeForm}=\\\"true\\\" on your Reflex Controller Element or pass { serializeForm: true } as an option to stimulate.`\n          )\n        // END TODO: remove\n\n        const formData =\n          options['serializeForm'] === false\n            ? ''\n            : serializeForm(form, {\n                element: reflexElement\n              })\n\n        reflex.data = {\n          ...reflexData.valueOf(),\n          params,\n          formData\n        }\n\n        // TODO: remove this in v4\n        controllerElement.reflexData[id] = reflex.data\n        // END TODO: remove\n\n        Transport.plugin.deliver(reflex)\n      })\n\n      Log.request(reflex)\n\n      return reflex.getPromise\n    },\n\n    // Wraps the call to stimulate for any data-reflex elements.\n    // This is internal and should not be invoked directly.\n    __perform (event) {\n      let element = event.target\n      let reflex\n\n      while (element && !reflex) {\n        reflex = element.getAttribute(Schema.reflex)\n        if (!reflex || !reflex.trim().length) element = element.parentElement\n      }\n\n      const match = attributeValues(reflex).find(\n        reflex => reflex.split('->')[0] === event.type\n      )\n\n      if (match) {\n        event.preventDefault()\n        event.stopPropagation()\n        this.stimulate(match.split('->')[1], element)\n      }\n    }\n  })\n\n  // Access the reflexes created by the current controller instance\n  // reflexes is a Proxy to an object, keyed by id\n  // this.reflexes.all and this.reflexes.last are scoped to this controller instance\n  // Reflexes can also be scoped by stage eg. this.reflexes.queued\n  if (!controller.reflexes)\n    Object.defineProperty(controller, 'reflexes', {\n      get () {\n        return new Proxy(reflexes, {\n          get: function (target, prop) {\n            if (prop === 'last') return this.lastReflex\n            return Object.fromEntries(\n              Object.entries(target[prop]).filter(\n                ([_, reflex]) => reflex.controller === this\n              )\n            )\n          }.bind(this)\n        })\n      }\n    })\n\n  scanForReflexesOnElement(controller.element)\n\n  emitEvent('stimulus-reflex:controller-registered', { detail: { controller } })\n}\n\nconst useReflex = (controller, options = {}) => {\n  register(controller, options)\n}\n\ndocument.addEventListener('cable-ready:after-dispatch-event', routeReflexEvent)\ndocument.addEventListener('cable-ready:before-inner-html', beforeDOMUpdate)\ndocument.addEventListener('cable-ready:before-morph', beforeDOMUpdate)\ndocument.addEventListener('cable-ready:after-inner-html', afterDOMUpdate)\ndocument.addEventListener('cable-ready:after-morph', afterDOMUpdate)\ndocument.addEventListener('readystatechange', () => {\n  if (document.readyState === 'complete') {\n    scanForReflexes()\n  }\n})\n\nexport {\n  initialize,\n  register,\n  useReflex,\n  reflexes,\n  scanForReflexes,\n  scanForReflexesOnElement\n}\n","export * from './stimulus_reflex'\n\nimport * as StimulusReflex from './stimulus_reflex'\n\nimport Debug from './debug'\nimport Deprecate from './deprecate'\n\nimport packageInfo from '../package.json'\n\nconst global = {\n  version: packageInfo.version,\n  ...StimulusReflex,\n  get debug () {\n    return Debug.value\n  },\n  set debug (value) {\n    Debug.set(!!value)\n  },\n  get deprecate () {\n    return Deprecate.value\n  },\n  set deprecate (value) {\n    Deprecate.set(!!value)\n  }\n}\n\nwindow.StimulusReflex = global\n\nexport default global\n"],"names":["app","Stimulus","set","application","defaultSchema","reflexAttribute","reflexPermanentAttribute","reflexRootAttribute","reflexSuppressLoggingAttribute","reflexDatasetAttribute","reflexDatasetAllAttribute","reflexSerializeFormAttribute","reflexFormSelectorAttribute","reflexIncludeInnerHtmlAttribute","reflexIncludeTextContentAttribute","schema","Schema","attribute","attributeName","slice","this","hasOwnProperty","Object","defineProperty","get","debugging","Debug$1","enabled","disabled","value","debug","duration","reflex","cloned","Date","timestamp","progress","totalOperations","completedOperations","Log","Debug","data","suppressLogging","console","log","target","id","args","controller","identifier","element","controllerElement","output","morph","payload","operation","selector","error","deprecationWarnings","Deprecate","deprecate","Reflex","constructor","valueOf","reflexElement","stage","lifecycle","warned","action","split","getPromise","promise","Promise","resolve","reject","warn","catch","uuidv4","crypto","window","msCrypto","replace","c","getRandomValues","Uint8Array","toString","camelize","uppercaseFirstLetter","$1","toUpperCase","toLowerCase","substr","emitEvent","event","detail","document","dispatchEvent","CustomEvent","bubbles","cancelable","jQuery","trigger","elementToXPath","body","nodeName","ix","siblings","parentNode","childNodes","i","length","sibling","tagName","nodeType","XPathToElement","xpath","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","XPathToArray","reverse","snapshotList","ORDERED_NODE_SNAPSHOT_TYPE","snapshots","snapshotLength","push","snapshotItem","attributeValue","values","Array","from","Set","filter","v","String","map","trim","join","attributeValues","extractElementAttributes","attrs","attributes","reduce","memo","attr","name","checked","selected","tag_name","match","includes","type","querySelectorAll","multipleInstances","collectedOptions","concat","elem","o","collectCheckedOptions","getElementsFromTokens","tokens","elements","xPath","forEach","token","extractDataAttributes","startsWith","ReflexData","options","reflexController","permanentAttributeName","url","tabId","_attrs","_id","selectors","_selectors","list","reflexRoot","getAttribute","s","querySelector","parentElement","closest","getReflexRoots","resolveLate","dataset","_dataset","reflexDataset","allDataset","reflexDatasetAll","allTokens","datasetElements","datasetAllElements","datasetAttributes","acc","ele","elementDataset","datasetAll","elementAttributes","keys","key","isArray","extractElementDataset","innerHTML","includeInnerHtml","textContent","includeTextContent","xpathController","xpathElement","formSelector","reflexFormSelector","undefined","reflexIncludeInnerHtml","reflexIncludeTextContent","reflexSuppressLogging","inner_html","text_content","version","packageInfo","isolationMode","IsolationMode","addEventListener","once","transport","Transport","plugin","newTransport","stages","lastReflex","reflexes","Proxy","prop","fromEntries","entries","_","Reflect","arguments","invokeLifecycleMethod","specificLifecycleMethod","genericLifecycleMethod","call","dispatchLifecycleEvent","received","cableReady","CableReady","reflexData","reflexOperations","operations","stimulusReflex","splice","some","location","href","reflexError","getControllerForElementAndIdentifier","pendingOperations","piggybackOperations","perform","reflexId","consumer","params","subscription","active","connected","connectionStatusClass","queued","send","rejected","disconnected","willAttemptReconnect","classList","contains","add","ActionCableTransport","subscribe","createConsumer","channel","StimulusReflex","request","JSON","stringify","subscriptions","findAll","create","deliver","initialize","consumerValue","paramsValue","beforeDOMUpdate","setTimeout","afterDOMUpdate","nothing","halted","forbidden","localReflexControllers","scanForReflexes","callback","delay","timeoutId","clearTimeout","debounce","scanForReflexesOnElement","controllerAttribute","controllers","reflexAttributeNames","actionAttribute","actions","reflexName","find","reflexString","extractReflexName","findControllerByReflexName","allReflexControllers","controllerName","controllerValue","actionValue","setAttribute","StimulusReflexController","Controller","super","register","isolate","MutationObserver","observe","documentElement","attributeFilter","childList","subtree","assign","stimulate","shift","Node","ELEMENT_NODE","getReflexElement","validity","badInput","opts","getReflexOptions","reflexPermanent","check","reflexSerializeForm","form","formData","w","FormData","e","encodeURIComponent","submitButton","serializeForm","__perform","preventDefault","stopPropagation","bind","useReflex","eventType","eventTypes","readyState","global"],"mappings":"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"}